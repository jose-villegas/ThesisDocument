\chapter{Conclusiones}
\label{chap:conclusion}
En este trabajo se han estudiado distintos algoritmos para el cálculo de iluminación indirecta en tiempo real. Se ha implementado una aproximación utilizando vóxeles y trazado de conos. El trazado de conos para \emph{ray tracing} fue propuesto por Amanatides en 1984 \cite{Amanatides:1984:RTC:800031.808589}. El mayor problema de esta aproximación es que calcular la colisión entre un cono y polígonos, es usualmente una operación muy compleja. Utilizando una representación simplificada de la escena en vóxeles, se evita esta desventaja realizando ahora un trazado aproximado. Por cada punto sobre una superficie se trazan conos para acumular la iluminación indirecta difusa y especular. Estos conos son trazados sobre la semiesfera orientada según el vector normal de este punto basándose en integración Monte Carlo. Esta acumulación es realizada utilizando muestreo sobre una estructura de vóxeles. A medida que el cono realiza su recorrido su diámetro se expande por tanto aumenta el tamaño del volumen a muestrear. Para esto se utiliza una estructura de vóxeles piramidal basada en \emph{mipmapping} con distintos niveles de detalle.

Nuestra implementación provee de manera efectiva una aproximación para la iluminación indirecta de uno y dos rebotes de luz. Esta implementación comprende distintos fenómenos de iluminación como reflexión difusa, reflexión especular, oclusión ambiental, sombras suaves, sombras indirectas, mezclado de colores y materiales emisivos. A pesar de esto, algunos defectos son de esperar al tratarse de aproximaciones. Los mayores problemas visuales surgen por discontinuidad entre vóxeles. Es posible obtener valores erróneos por distintas causas como longitud de marcha o errores de voxelización. Esto usualmente ocasiona \emph{light leaking} o escape de luz en algunas partes de ciertas escenas. Otro problema notable es la aparición de \emph{color banding} o bandas de colores sobre reflexiones especulares finas. Esto es un error de muestreo sobre los vóxeles, que puede solucionarse disminuyendo la longitud de marcha del cono. Sin embargo esto implica un alto costo en rendimiento.

Este trabajo utiliza texturas tridimensionales para almacenar la representación en vóxeles. Esto simplifica la construcción de la estructura jerárquica y el filtrado cuadrilineal utilizado durante el muestreo en el trazado de conos. La captura de la iluminación directa sobre los vóxeles se realiza utilizando \emph{compute shaders}; para esto se voxeliza también las normales de la escena. Debido a que un promedio de normales puede traer ciertos problemas de disparidad, se implementó un modelo de sombreado para los vóxeles basado en la atenuación normal por cada cara del vóxel ponderada. Para obtener resultados precisos durante el trazado de conos es necesario incluir oclusión durante el sombreado de vóxeles. Nuestra propuesta realiza \emph{ray tracing} sobre un volumen producto de la voxelización y además se implementó un método para la generación de sombras suaves, basado en el número de colisiones de un rayo contra geometría voxelizada. Con la voxelización de las normales este trabajo permite el cálculo de iluminación global sobre la representación de vóxeles. Esto se hace utilizando el mismo algoritmo de trazado de conos contra vóxeles en un \emph{compute shader}, solo que este se realiza desde vóxeles en vez de fragmentos.

\section{Trabajos Futuros} % (fold)
\label{sec:trabajos_futuros}
Nuestra implementación provee buenos resultados tanto en calidad visual como en rendimiento, sin embargo podría beneficiarse de futuros estudios y ciertas mejoras en la aplicación. En nuestra implementación el método de voxelización utilizado es conservativo con solo el contorno. Para solventar problemas de \emph{light-leaking}, explorar alternativas de voxelización sólida (incluyendo vóxeles internos en la geometría) podría ayudar a reducir estos problemas, ya que este es causado usualmente por la opacidad de vóxeles cercanos. Además de esto un esquema de voxelización sólida podría abrir la posibilidad a explorar otras técnicas de iluminación, como objetos con transluminiscencia \cite{Eisemann:2008:SGS:1375714.1375728}.

Un problema en nuestra propuesta es el consumo en memoria. Esto podría reducirse utilizando la estructura \emph{octree} dispersa. Sin embargo esto trae un costo agregado para la construcción de esta estructura y su recorrido. Una posibilidad reciente es el uso de texturas dispersas. Sin embargo, las extensiones que proveen esta funcionalidad en OpenGL son muy recientes, y para el momento de este trabajo la reserva de espacios de memoria sobre estas texturas todavía se hace del lado del CPU, lo cual puede ser muy lento cuando se considera la actualización dinámica de esta estructura.

El nivel de detalle de voxelización depende del espacio de voxelización y la resolución de la cuadrícula de vóxeles. Usualmente la información más relevante al usuario se encuentra cercana al observador. Esta cualidad se podría explotar para realizar voxelización por distintas cuadrículas, donde las cuadrículas cercanas al observador proveen mayor nivel de detalle para la representación en vóxeles. Esto permitiría manejar escenas de gran escala con mayor facilidad. Existen ya algunos recursos relacionados a esto como volúmenes de vóxeles en cascada \cite{McLaren:2015:TCL:2775280.2792546}.

El trazado de conos puede ser acelerado utilizando variadas técnicas para reducir el número de píxeles a muestrear. Una técnica sencilla es realizar el cálculo de iluminación indirecta en un paso a parte a menor resolución y luego integrar este resultado como un post-proceso. Esto puede hacer que se pierda precisión especialmente en los bordes de la geometría en escena. Para estos casos se puede utilizar algún algoritmo de detección de bordes y realizar el trazado de conos a resolución completa en estos píxeles. Los problemas de color banding en la reflexión especular pueden ser solventados de manera más eficiente utilizando \emph{dithering} sobre la reflexión especular resultante en este post-proceso.
% section trabajos_futuros (end)
